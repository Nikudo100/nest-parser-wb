generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URI")
}

model Product {
  id             Int      @id @default(autoincrement())
  nmid           BigInt   @unique // WB id
  name           String?
  brand          String?
  image          String?
  supplier       String? // STIK.STORE
  supplierId     Int?
  supplierRating Float?
  rating         Float?
  reviewRating   Float?
  feedbacks      Int?
  price          Int?
  totalQuantity  Int?
  is_our_product Boolean  @default(false)
  colors         Json?
  parsedAt       DateTime @default(now())

  stockHistory    DailyStockSnapshot[]
  warehouseStocks WarehouseStock[]

  @@index([nmid])
}

model DailyStockSnapshot {
  id         Int      @id @default(autoincrement())
  date       DateTime
  totalStock Int
  product    Product  @relation(fields: [productId], references: [id])
  productId  Int

  @@unique([productId, date]) // Чтобы не было дубликатов по дате
}

model WarehouseStock {
  id       Int     @id @default(autoincrement())
  wh       Int // ID склада
  dtype    Int?
  dist     Int?
  qty      Int
  priority Int?
  time1    Int?
  time2    Int?
  sizeName String? // sizes[].name
  sizeRank Int? // sizes[].rank
  optionId BigInt? // sizes[].optionId

  product   Product @relation(fields: [productId], references: [id])
  productId Int

  createdAt DateTime @default(now())

  @@index([productId])
}
